import{a as v,u as N,j as e}from"./utils.KUeWt-uN.js";import{r as o}from"./index.BJfUAbRs.js";const p="weather_cache",E=30*60*1e3,L=()=>{const f=v(new URL(window.location.href)),l=N(f),[t,m]=o.useState(null),[h,n]=o.useState(""),[g,s]=o.useState(!1),x=o.useCallback((a=!1)=>{if(s(!0),n(""),!navigator.geolocation){n("Geolocation not supported"),s(!1);return}navigator.geolocation.getCurrentPosition(async u=>{const i=u.coords.latitude,d=u.coords.longitude;if(!a){const r=localStorage.getItem(p);if(r){const{data:c,timestamp:w,lat:b,lon:j}=JSON.parse(r);if(Date.now()-w<E&&Math.abs(b-i)<.01&&Math.abs(j-d)<.01){m(c),s(!1);return}}}try{const r=await fetch(`/api/weather?lat=${i}&lon=${d}`);if(!r.ok)throw new Error("API error");const c=await r.json();m(c),localStorage.setItem(p,JSON.stringify({data:c,timestamp:Date.now(),lat:i,lon:d}))}catch{n(l("sidebar.weatherWidget.fetchError"))}finally{s(!1)}},()=>{n(l("sidebar.weatherWidget.locationError")),s(!1)})},[l]);return o.useEffect(()=>{x()},[]),h?e.jsx("div",{className:"text-sm p-2 text-center",children:h}):e.jsx("div",{className:"mt-4 m-1 p-2 text-sm text-center rounded bg-base-100 shadow relative",children:!g&&t?e.jsxs(e.Fragment,{children:[e.jsx("button",{type:"button",className:"absolute top-1 right-1 btn btn-xs btn-ghost btn-circle","aria-label":"Refresh weather",onClick:()=>x(!0),disabled:g,children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:"1",stroke:"currentColor",className:"size-4",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M16.023 9.348h4.992v-.001M2.985 19.644v-4.992m0 0h4.992m-4.993 0 3.181 3.183a8.25 8.25 0 0 0 13.803-3.7M4.031 9.865a8.25 8.25 0 0 1 13.803-3.7l3.181 3.182m0-4.991v4.99"})})}),e.jsxs("div",{className:"mb-1 font-semibold",children:[t.city?`${t.city} `:""," ",t.currentTemp,"°C"," ",t.currentWeather]}),e.jsx("div",{className:"flex gap-2 overflow-x-auto",children:t.hourly.map(a=>e.jsxs("div",{className:"flex flex-col items-center min-w-[48px]",children:[e.jsxs("span",{className:"text-xs",children:[new Date(a.dt*1e3).getHours(),":00"]}),e.jsx("img",{src:`https://openweathermap.org/img/wn/${a.icon}.png`,alt:"",className:"w-6 h-6"}),e.jsxs("span",{className:"text-xs",children:[a.temp,"°"]})]},a.dt))})]}):e.jsx("span",{className:"loading loading-spinner loading-sm"})})};export{L as WeatherWidget};
